
## Технический стек
Frontend:
* langauge: TypeScript
* environment: NodeJS
* web-library: React
* ui-kit: Tailwind + Shadcn
* validation: zod
* unit-testing: jest

Backend:
* language: TypeScript
* environment: NodeJs
* framework: NestJs
* db: MongoDb Atlas
* cache: Redis
* unit-testing: jest

Deployment:
* server: Ubuntu
* containers: Docker

## Структура монорепозитория
Проект реализован в формате **monorepo**, где фронтенд и бэкенд находятся в едином репозитории:

**Тип архитектуры**: *Client-Server*
####  **Frontend**  
**Путь**: `pet-market/pet-market-frontend/`
- Отвечает за пользовательский интерфейс.
- Взаимодействует с сервером через REST API.
####  **Backend**  
**Путь**: `pet-market/pet-market-backend/`
- Реализует бизнес-логику, авторизацию и работу с базой данных.
- API структурированы по REST-принципу.
- Модули разделены по зонам ответственности (аутентификация, пользователи, товары и т.д.).
##### Примерная структура модулей backend:  
- `auth/` — аутентификация и авторизация  
- `users/` — управление пользователями  
- `kennels/` — управление питомниками  
- `categories/` — категории животных  
- `pets/` — управление питомцами  
- `common/` — общие типы, константы, утилиты  
  
####  **Api**  
**Путь**: `pet-market/api/`
- Вся спецификация REST API описана в Bruno-коллекции (`api/`).  
- Для каждого модуля backend есть соответствующие .bru-файлы с примерами запросов и описанием ошибок.

---

##  Авторизация и Аутентификация

Используется библиотека **passport.js** совместно с **JWT** (JSON Web Token).

#### Как работает авторизация:

1. **Регистрация / Вход**
   - При входе/регистрации пользователь получает JWT access-токен и refresh-токен.
   - Access-токен используется для доступа к защищённым маршрутам, refresh — для его обновления.
   - Время жизни access - 15 минут, refresh - 7 дней

2. **Public-декоратор**
   - Нужные маршруты (например, login или register) помечаются специальным **Public-декоратором**.
   - Это означает, что они доступны без авторизации.

3. **Role-декоратор**
   - Для ограничения доступа по ролям используется **Role-декоратор**.
   - Примеры ролей: `user`, `admin`, `seller`.
   - Роуты проверяют наличие соответствующей роли у пользователя и отказывают в доступе при её отсутствии.

4. **Refresh токен**
   - При истечении срока действия access-токена можно отправить refresh-токен на соответствующий эндпоинт.
   - Сервер проверяет refresh-токен и выдает новую пару access/refresh токенов.

5. **Logout**
   - Logout удаляет refresh-токен из базы данных.
   - После logout текущие токены становятся недействительными, и пользователь должен пройти повторную аутентификацию.

6. **Обработка ошибок**
   - Все используемые ошибки стандартизированы и описаны в  **Bruno**

---
## Users Module
  
Модуль отвечает за управление пользователями, их регистрацией, связью с питомниками и базовыми операциями CRUD.  
  
### Основные возможности:  
  
1. **Регистрация и создание пользователя**  
   - `createUser(dto: CreateUserDto)` — регистрация нового пользователя с email, username и паролем (hash).  
   - Проверка уникальности email.  
  
2. **Получение пользователя**  
   - `getUser(email: string)` — получение пользователя по email (без пароля).  
   - `getUserWithHash(email: string)` — получение пользователя с паролем (для аутентификации).  
   - `getUserById(id: ObjectId)` — получение пользователя по id.  
  
3. **Связь с питомником**  
   - `setKennelId(userId: ObjectId, kennelId: ObjectId)` — привязка пользователя к питомнику.  
   - `deleteKennelFromUsers(kennelId: ObjectId)` — удаление связи всех пользователей с питомником.  
  
4. **Удаление пользователя**  
   - `deleteUser(id: ObjectId)` — удаление пользователя из системы.  
  
---  
  
## Categories Module
  
Модуль отвечает за работу с категориями животных, как системными, так и кастомными.  
  
### Основные возможности:  
  
1. **Системные и пользовательские категории**  
   - `getSystemCategories()` — получение системных категорий.  
   - `createCustomCategory(kennelId: ObjectId, dto: CreateCustomCategoryDto)` — создание пользовательской категории.  
  
2. **Получение и проверка категории**  
   - `getCategoryById(id: ObjectId)` — получение категории по id.  
   - `isSystemCategory(id: ObjectId)` — проверка, является ли категория системной.  
   - `checkCategory(kennelId: ObjectId, categoryId: ObjectId)` — проверка доступа к категории.  
  
3. **Включение/отключение категории**  
   - `enableCategory(id: ObjectId)` — включение категории.  
   - `disableCategory(id: ObjectId)` — временное отключение категории (может отключать связанных питомцев).  
   - `restoreCategory(categoryId: ObjectId, kennelId: ObjectId)` — восстановление категории.  
  
4. **Удаление категории**  
   - `deleteCategory(id: ObjectId)` — удаление пользовательской категории (системные удалить нельзя).  
  
  
---  
## Дополнительно

- Все секреты, ключи JWT, URL базы данных и другие параметры конфигурации хранятся в `.env` файле.
- Для подробностей по каждому методу и структурам данных см. исходный код и документацию в Bruno.